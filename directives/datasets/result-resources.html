<div class="dataset-list unstyled">
    <h2 class="list-heading">Recursos y descargas</h2>
    <div class="dataset-item clearfix"  ng-repeat="resource in files">
        <div class="dataset-content">
            <!--<span class="dataset-category-icon {{category.name| slug}}" data-tooltip="{{category.name}}" ng-repeat="category in result.categories">
            </span>-->
            <h3 class="dataset-heading">
                {{resource.name}}
                <!--<a ng-href="#/dataset/{{result.id | lowercase}}" ng-title="{{result.name}}">{{result.name}}</a>-->
            </h3>
            <div class="dataset-latest-update">Fecha de publicación: {{resource.publishedAt| amDateFormat:'DD/MM/YYYY'}}<span class="dataset-latest-update-date"></span></div>
            <div class="dataset-description" ng-bind-html="getHtml(resource.description)"></div>
        </div>
        <div class="dataset-resources unstyled">
            <span class="dataset-additional-info" ng-click="toggleDropdown($event)" ng-if="resource.additional_info && resource.additional_info.length">Info adicional</span>
            <table class="dataset-additional-info-table dataset-additional-info-table-inactive" ng-if="resource.additional_info && resource.additional_info.length">
                <thead>
                    <tr>
                        <th>Campo</th>
                        <th>Valor</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="adt_info in resource.additional_info">
                        <td>{{adt_info.clave}}</td>
                        <td>{{adt_info.valor}}</td>
                    </tr>
                </tbody>
            </table>
            <div class="resource-actions pull-right">
                <div class="dropdown no-hover">
                    <a ng-if="true || !!resource.resources.data.maps || !!resource.resources.data.charts" class="widget-item-footer-link widget-item-footer-preview-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" ng-class="{'active': resource.type_resource}"></a>
                    <ul class="dropdown-menu">
                        <li ng-if="true || resource.type.api">
                            <a ng-click="toogleTypeResource('tables', resource)">Ver tabla</a>
                        </li>
                        <li ng-if="true || !!resource.resources.data.charts">
                            <a ng-click="toogleTypeResource('charts', resource)">Ver gráfico</a>
                        </li>
                        <li ng-if="true || !!resource.resources.data.maps">
                            <a ng-click="toogleTypeResource('maps', resource)">Ver mapa</a>
                        </li>
                    </ul>
                </div>
                <div class="dropdown no-hover">
                    <a class="widget-item-footer-link widget-item-footer-download-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                    </a>
                    <ul class="dropdown-menu">
                        <li ng-repeat="resource in files">
                            <a ng-href="#/resource/{{resource.id| lowercase}}" data-format="{{fileTypes[resource.type.id]}}" data-format="{{fileTypes[resource.type.id]|| lowercase}}">{{fileTypes[resource.type.id]| uppercase}}</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div>
                <div ng-repeat="map in resource.resources.data.maps" ng-if="resource.type_resource == 'maps'">
                    <span ng-click="toogleTypeMap(map.type)">{{map.type}}</span>
                </div>
                <div ng-repeat="map in resource.resources.data.maps" ng-if="resource.type_resource == 'maps'">
                    <leaflet ng-if="!map.link" lf-center="center" id="iframeDiv" geojson="map.geojson"></leaflet>
                    <iframe id="iframeDiv" ng-src="{{ map.link | trustUrl }}" ng-if="map.link"></iframe>
                </div>
            </div>
            <div>
                <div ng-repeat="chart in resource.resources.data.charts" ng-if="resource.type_resource == 'charts'">
                    <span ng-click="toogleTypeChart(chart.id, resource)">{{chart.type}}</span>
                </div>
                <div ng-repeat="chart in resource.resources.data.charts" ng-if="resource.type_resource == 'charts'">
                    <iframe id="iframeDiv" ng-if="chart.link" ng-src="{{ chart.link | trustUrl}}"></iframe>
                    <canvas ng-if="!chart.link && chart.id == resource.type_chart" id="iframeDiv" class="chart chart-base" chart-type="chart.type"
                            chart-data="chart.data.data" chart-labels="chart.data.labels"></canvas>
                </div>
            </div>
            <div>
                <div ng-if="resource.type_resource == 'tables'" class="div-table">
                    <div class="table-responsive">
                        <table class="table dataset-additional-info-table">
                            <thead>
                                <tr>
                                    <th ng-repeat="(key, val) in resource.contents.data[0]" ng-if="key !== '_id' && key !== 'GEOJSON'">{{key}}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="field in resource.contents.data">
                                    <td ng-repeat="(key, val) in field" ng-if="key !== '_id' && key !== 'GEOJSON'">{{val}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="paging">
                        <paging page="resource.contents.meta.page" page-size="limit" total="resource.contents.meta.count"
                                paging-action="paging('pageClick', page, pageSize, total, resource)" 
                                show-prev-next="true"
                                show-first-last="true" hide-if-empty="true"></paging> 
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>